<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Wäsche Counter</title>

  <!-- iOS App -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Wäsche Counter">
  <meta name="theme-color" content="#0b0b0f">

  <!-- Icon -->
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/x5vrjm6476-ux/waesche.app/bd3487075d725cc73723d8e129ffed9ad7719775/waeschapp.jpg">

  <style>
    /* --- BASIC LAYOUT --- */
    html,body{
      margin:0;
      height:100%;
      background:#0b0b0f;
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,system-ui;
      overflow:hidden;
    }

    body{
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .screen{
      width:100%;
      max-width:520px;
      padding:24px;
      display:none;
    }

    .screen.active{ display:block; }

    h1{ margin:0 0 16px 0; }

    input, button{
      font-size:16px;
      padding:14px;
      border-radius:12px;
      border:none;
      outline:none;
    }

    input{
      width:100%;
      background:#1c1c1f;
      color:white;
      margin-bottom:12px;
    }

    button{
      background:#222;
      color:white;
      cursor:pointer;
    }

    button.primary{
      background:#2c2c2f;
    }

    .card{
      background:#161618;
      border-radius:16px;
      padding:16px;
      margin-bottom:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .big{
      font-size:32px;
      font-weight:700;
    }

    .muted{ opacity:.6 }

    .reset{
      text-align:center;
      margin-top:20px;
      opacity:.4;
      cursor:pointer;
    }
  </style>
</head>

<body>

<!-- JOIN / CREATE -->
<div class="screen active" id="screen-join">
  <h1>Wäsche Counter</h1>

  <button class="primary" onclick="createRoom()">➕ Neuen Raum erstellen</button>
  <br><br>
  <input id="joinCode" placeholder="Code eingeben (z.B. A9F2QZ)">
  <button onclick="joinRoom()">Beitreten</button>
</div>

<!-- APP -->
<div class="screen" id="screen-app">
  <h1 id="roomLabel"></h1>

  <div class="card" id="cardHot">
    <div>
      <div class="muted">60° Wäsche</div>
      <div class="big" id="hot">0</div>
    </div>
    <button onclick="add('hot')">+</button>
  </div>

  <div class="card" id="cardNormal">
    <div>
      <div class="muted">Normale Wäsche</div>
      <div class="big" id="normal">0</div>
    </div>
    <button onclick="add('normal')">+</button>
  </div>

  <div class="card">
    <div>
      <div class="muted">Summe</div>
      <div class="big" id="sum">CHF 0.00</div>
    </div>
  </div>

  <div class="reset" onclick="resetAll()">zurücksetzen</div>
</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBJ3jy8zoaFcJNznWOIc2t1fAt5chyIlIg",
    authDomain: "waesche-c1216.firebaseapp.com",
    projectId: "waesche-c1216",
    databaseURL: "https://waesche-c1216-default-rtdb.europe-west1.firebasedatabase.app",
    storageBucket: "waesche-c1216.appspot.com",
    messagingSenderId: "46158448054",
    appId: "1:46158448054:web:0becbeb7c7ed2b39bbad17"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let room = null;

  function randomCode(){
    return Math.random().toString(36).substring(2,8).toUpperCase();
  }

  window.createRoom = () => {
    room = randomCode();
    initRoom();
  }

  window.joinRoom = () => {
    const code = document.getElementById("joinCode").value.trim().toUpperCase();
    if(!code) return;
    room = code;
    initRoom();
  }

  function initRoom(){
    document.getElementById("screen-join").classList.remove("active");
    document.getElementById("screen-app").classList.add("active");
    document.getElementById("roomLabel").textContent = "Raum " + room;

    const roomRef = ref(db, "rooms/" + room);

    set(roomRef, { hot: 0, normal: 0 });

    onValue(roomRef, snap => {
      const d = snap.val();
      if(!d) return;
      document.getElementById("hot").textContent = d.hot;
      document.getElementById("normal").textContent = d.normal;
      document.getElementById("sum").textContent =
        "CHF " + (d.hot * 1.5 + d.normal).toFixed(2);
    });
  }

  window.add = (type) => {
    const r = ref(db, "rooms/" + room);
    update(r, {
      [type]: (type === "hot" ? +document.getElementById("hot").textContent : +document.getElementById("normal").textContent) + 1
    });
  }

  window.resetAll = () => {
    if(confirm("Alles zurücksetzen?")){
      const r = ref(db, "rooms/" + room);
      set(r, { hot: 0, normal: 0 });
    }
  }
</script>
</body>
</html>